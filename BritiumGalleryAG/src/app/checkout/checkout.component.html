<div class="checkout-container">

  <!-- LEFT SIDE: Checkout Form -->
  <div class="checkout-form-section">
    <form [formGroup]="checkoutForm" (ngSubmit)="submitCheckout()">
      <!-- Shipping Address -->
      <h3>Shipping Address</h3>
      <div class="form-group">
        <label for="name">Name</label>
        <input id="name" [value]="checkoutForm.get('name')?.value" disabled class="read-only-input" placeholder="Name" />
      </div>

      <div class="form-group-row">
        <div class="form-group" style="flex: 1; margin-right: 10px;">
          <label for="email">Email</label>
          <input id="email" [value]="checkoutForm.get('email')?.value" disabled class="read-only-input" placeholder="Email" />
        </div>
        <div class="form-group" style="flex: 1;">
          <label for="phone">Phone Number</label>
          <input id="phone" [value]="checkoutForm.get('phone')?.value" disabled class="read-only-input" placeholder="Phone" />
        </div>
      </div>

      <!-- Main Address Display -->
      <div class="form-group" *ngIf="mainAddressDTO">
        <label for="mainAddress">Main Address</label>
        <div class="form-group-row address-edit-group">
          <input id="mainAddress" type="text" [value]="mainAddress" readonly class="read-only-input" />
          <button type="button" class="edit-btn" (click)="editAddress()">Edit</button>
        </div>
      </div>

      <!-- Toggle Modal -->
      <div class="form-group">
        <button type="button" class="btn-toggle" (click)="openAddressModal()">Show All Addresses</button>
      </div>

      <!-- Shipping Method -->
      <h3>Shipping Method</h3>
      <div class="form-group">
        <label for="shippingMethod">Choose Shipping Method</label>
        <select id="shippingMethod" formControlName="shippingMethod" class="shipping-select">
          <option value="Standard" [disabled]="suggestedMethod !== 'Standard'">Standard Shipping</option>
          <option value="Express" [disabled]="suggestedMethod !== 'Express'">Express Shipping</option>
          <option value="Ship" [disabled]="suggestedMethod !== 'Ship'">Ship Shipping</option>
        </select>
      </div>

      <div class="form-group" *ngIf="checkoutForm.get('shippingMethod')?.value !== 'Standard' && selectedDelayRange">
        <div class="method-notice"
          style="padding: 8px; background-color: #fff7e6; border-left: 4px solid #ffc107; margin-top: 5px; border-radius: 4px;">
          üì¢ Delivery method changed to <strong>{{ checkoutForm.get('shippingMethod')?.value }}</strong>
          based on your address distance.
        </div>
      </div>

      <!-- Standard Provider -->
      <div class="form-group" *ngIf="checkoutForm.get('shippingMethod')?.value === 'Standard'">
        <label for="standardName">Choose Standard Provider</label>
        <select id="standardName" formControlName="standardName" class="shipping-select">
          <option value="" disabled>Select a provider</option>
          <option *ngFor="let standard of standardOptions" [value]="standard.name">{{ standard.name }}</option>
        </select>
      </div>

      <!-- Express Provider -->
      <div class="form-group" *ngIf="checkoutForm.get('shippingMethod')?.value === 'Express'">
        <label for="expressName">Choose Express Provider</label>
        <select id="expressName" formControlName="expressName" class="shipping-select">
          <option value="" disabled selected>Select a provider</option>
          <option *ngFor="let express of expressOptions" [value]="express.name">{{ express.name }}</option>
        </select>
      </div>

      <!-- Ship Provider -->
      <div class="form-group" *ngIf="checkoutForm.get('shippingMethod')?.value === 'Ship'">
        <label for="shipName">Choose Ship Provider</label>
        <select id="shipName" formControlName="shipName" class="shipping-select">
          <option value="" disabled selected>Select a provider</option>
          <option *ngFor="let ship of shipOptions" [value]="ship.name">{{ ship.name }}</option>
        </select>
      </div>

      <!-- Payment -->
      <h3>Payment</h3>
      <div class="form-group">
        <label>
          <input type="radio" formControlName="paymentType" value="CreditCard" /> Credit Card
        </label>
      </div>
      <input formControlName="cardNumber" placeholder="Card Number" />
      <div class="form-group-row">
        <input formControlName="expiry" placeholder="Expiry" />
        <input formControlName="cvv" placeholder="CVV" />
      </div>

      <button type="submit" class="place-order-btn">Place Order</button>
    </form>
  </div>

  <!-- RIGHT SIDE: Summary -->
  <div class="cart-summary-section">
    <div class="promo-box">
      <h3>Promo Code</h3>
      <div class="promo-input-group">
        <input type="text" [(ngModel)]="promoCode" placeholder="Enter promo code">
        <button class="apply-btn" (click)="applyPromo()">Apply Code</button>
      </div>
    </div>

    <div class="order-summary-box">
      <h3>Order Summary</h3>
      <div class="summary-row"><span>Subtotal</span><span>MMK {{ getSubtotal() | number:'1.0-0' }}</span></div>
      <div class="summary-row"><span>Items</span><span>{{ getTotalItems() }}</span></div>
      <div class="summary-row"><span>Delivery Fee</span><span>MMK {{ deliveryFee | number:'1.0-0' }}</span></div>
      <div class="summary-row" *ngIf="selectedDelayRange">
        <span>Estimated Delivery</span><span>{{ selectedDelayRange }}</span>
      </div>
      <div class="summary-row total">
        <span>Total</span><span>MMK {{ getTotalCost() | number:'1.0-0' }}</span>
      </div>
    </div>
  </div>

  <!-- üßæ Modal for All Addresses -->
<div class="modal-backdrop" *ngIf="isAddressModalOpen">
  <div class="modal-content">
    <div class="modal-header">
      <h3>My Addresses</h3>
      <button class="close-btn" (click)="closeAddressModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div *ngFor="let address of addresses" class="address-card">
        <p>
          {{ address.houseNumber }}, {{ address.street }}, {{ address.wardName }}, {{ address.township }},
          {{ address.city }}, {{ address.state }}, {{ address.country }},
          {{ address.postalCode || 'N/A' }}
        </p>

        <!-- Use icon button to set as main -->
        <button *ngIf="address.id !== mainAddressId"
                class="icon-button"
                (click)="setAsMain(address.id!)"
                title="Set as Main Address">
          ‚≠ê
        </button>

        <!-- Show icon label if it's main address -->
        <span *ngIf="address.id === mainAddressId" class="main-label" title="Main Address">
          üè† Main
        </span>
      </div>
    </div>
  </div>
</div>
