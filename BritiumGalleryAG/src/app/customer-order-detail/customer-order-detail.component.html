<div class="order-detail-wrapper">
  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h3>Loading Order Details</h3>
      <p>Please wait while we fetch your order information...</p>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error">
    <div class="error-content">
      <div class="error-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="12" cy="12" r="10" />
          <line x1="15" y1="9" x2="9" y2="15" />
          <line x1="9" y1="9" x2="15" y2="15" />
        </svg>
      </div>
      <h3>Unable to Load Order</h3>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadOrderDetails()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <polyline points="23,4 23,10 17,10" />
          <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10" />
        </svg>
        Try Again
      </button>
    </div>
  </div>

  <!-- Order Detail Content -->
  <div class="order-detail-content" *ngIf="order && !loading && !error">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-content">
        <div class="order-title-section">
          <div class="order-number">
            <span class="order-label">Order</span>
            <h1 class="order-id">#{{ order?.trackingCode }}</h1>
          </div>
          <div class="order-meta">
            <div class="order-date">
              <span class="date-label">Placed on </span>
              <span class="date-value">{{
                order?.orderDate | date : "mediumDate"
              }}</span>
            </div>
          </div>
        </div>

        <div class="status-section">
          <div class="status-badge" [ngClass]="order?.status?.toLowerCase()">
            <span class="status-dot"></span>
            <span class="status-text">{{ order?.status }}</span>
          </div>
          <div
            *ngIf="order && order?.status === 'PENDING' && !loading && !error"
            class="pending-countdown-bar-compat"
          >
            <div class="countdown-info">
              <span class="countdown-label">Time left to pay:</span>
              <span
                class="countdown-timer"
                [ngClass]="getCountdownColorClass()"
                >{{ countdown }}</span
              >
            </div>
            <button
              class="pay-now-btn"
              *ngIf="showPayButton"
              (click)="payNow(order?.id)"
            >
              Pay Now
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Countdown & Pay Button for Pending Orders (moved below status) -->

    <!-- Top right Export button with arrow icon and styled as requested -->
    <div
      style="
        display: flex;
        justify-content: flex-end;
        align-items: center;
        margin-bottom: 16px;
      "
    >
      <div class="export-btn-wrapper">
        <button
          (click)="downloadPDF()"
          [disabled]="!canExportPDF()"
          [ngClass]="{ 'export-enabled': canExportPDF() }"
          style="
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 22px;
            background: #fff;
            color: #111;
            border: 2px solid #111;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s, color 0.2s, border 0.2s;
          "
        >
          Export
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="vertical-align: middle"
          >
            <line x1="5" y1="12" x2="19" y2="12" />
            <polyline points="12 5 19 12 12 19" />
          </svg>
        </button>
      </div>
    </div>
    <!-- Removed voucher review modal and voucher-crumple related code -->

    <!-- Main Content -->
    <div class="main-content">
      <div class="content-grid">
        <!-- Left Column: Order Information -->
        <div class="info-column">
          <!-- Customer Information Card -->
          <div class="info-card">
            <div class="card-header">
              <div class="card-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
              </div>
              <h3 class="card-title">Customer Information</h3>
            </div>

            <div class="card-content">
              <div class="info-group">
                <div class="info-item">
                  <span class="info-label">Full Name</span>
                  <span class="info-value">{{ order?.user?.name }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Email Address</span>
                  <span class="info-value">{{ order?.user?.email }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Phone Number</span>
                  <span class="info-value">{{ order?.user?.phoneNumber }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Delivery Information Card -->
          <div class="info-card">
            <div class="card-header">
              <div class="card-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z" />
                  <circle cx="12" cy="10" r="3" />
                </svg>
              </div>
              <h3 class="card-title">Delivery Information</h3>
            </div>

            <div class="card-content">
              <div class="info-group">
                <div class="info-item">
                  <span class="info-label">Delivery Method</span>
                  <span class="info-value"
                    >{{ order?.deliveryMethod }} -
                    {{ order?.deliveryProvider }}</span
                  >
                </div>
                <div class="info-item">
                  <span class="info-label">Delivery Address</span>
                  <div class="address-value">
                    <div class="address-line">
                      {{ order?.deliveryAddress?.houseNumber }},
                      {{ order?.deliveryAddress?.street }},{{
                        order?.deliveryAddress?.wardName
                      }}, {{ order?.deliveryAddress?.township }},{{
                        order?.deliveryAddress?.city
                      }}, {{ order?.deliveryAddress?.state }},{{
                        order?.deliveryAddress?.country
                      }}
                    </div>
                  </div>
                </div>
                <div class="info-item" *ngIf="order?.estimatedDeliveryTime">
                  <span class="info-label">Estimated Delivery</span>
                  <span class="info-value">{{
                    order?.estimatedDeliveryTime | date : "mediumDate"
                  }}</span>
                </div>
                <div
                  class="info-item"
                  *ngIf="
                    !order?.estimatedDeliveryTime && order?.selectedDelayTime
                  "
                >
                  <span class="info-label">Estimated Delivery</span>
                  <span class="info-value">{{ order?.selectedDelayTime }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Payment Information Card -->
          <div class="info-card" *ngIf="transaction">
            <div class="card-header">
              <div class="card-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
                  <line x1="1" y1="10" x2="23" y2="10" />
                </svg>
              </div>
              <h3 class="card-title">Payment Information</h3>
            </div>
            <div class="card-content">
              <div class="payment-grid">
                <div class="payment-details">
                  <div class="info-group">
                    <div class="info-item">
                      <span class="info-label">Payment Status</span>
                      <span
                        class="payment-status"
                        [ngClass]="transaction.status?.toLowerCase()"
                      >
                        <span class="status-dot"></span>
                        {{ transaction.status }}
                      </span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Payment Method</span>
                      <span class="info-value">{{
                        transaction.paymentMethod
                      }}</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Amount Paid</span>
                      <span class="info-value amount"
                        >MMK {{ transaction.amount | number : "1.0-0" }}</span
                      >
                    </div>
                    <div class="info-item" *ngIf="transaction.notes">
                      <span class="info-label">Payment Notes</span>
                      <span class="info-value">{{ transaction.notes }}</span>
                    </div>
                    <div class="info-item" *ngIf="transaction.createdAt">
                      <span class="info-label">Submitted At</span>
                      <span class="info-value">{{
                        transaction.createdAt | date : "medium"
                      }}</span>
                    </div>
                    <div class="info-item" *ngIf="transaction.confirmedAt">
                      <span class="info-label">Confirmed At</span>
                      <span class="info-value">{{
                        transaction.confirmedAt | date : "medium"
                      }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column: Order Items & Summary -->
        <div class="summary-column">
          <!-- Order Items Card -->
          <div class="summary-card">
            <div class="card-header">
              <div class="card-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <circle cx="9" cy="21" r="1" />
                  <circle cx="20" cy="21" r="1" />
                  <path
                    d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"
                  />
                </svg>
              </div>
              <h3 class="card-title">Order Items</h3>
              <span class="items-count"
                >{{ order?.orderDetails?.length }} items</span
              >
            </div>

            <div class="card-content">
              <div class="items-preview">
                <div
                  class="item-card"
                  *ngFor="let item of order?.orderDetails.slice(0, 1)"
                  [ngClass]="{ 'refunded-item': item.isRefunded }"
                >
                  <div class="item-image-container">
                    <img
                      *ngIf="item.variant?.imageUrls?.length"
                      [src]="item.variant.imageUrls[0]"
                      [alt]="item.variant?.productName"
                      class="item-image"
                    />
                    <div
                      *ngIf="!item.variant?.imageUrls?.length"
                      class="item-placeholder"
                    >
                      <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                      >
                        <rect
                          x="3"
                          y="3"
                          width="18"
                          height="18"
                          rx="2"
                          ry="2"
                        />
                        <circle cx="8.5" cy="8.5" r="1.5" />
                        <polyline points="21,15 16,10 5,21" />
                      </svg>
                    </div>
                    <div class="quantity-badge">{{ item.quantity }}</div>
                    <div *ngIf="item.isRefunded" class="refunded-badge">
                      Refunded{{
                        item.refundedQty ? " (" + item.refundedQty + ")" : ""
                      }}
                    </div>
                  </div>

                  <div class="item-details">
                    <h4 class="item-name">{{ item.variant?.productName }}</h4>
                    <p class="item-sku" *ngIf="item.variant?.sku">
                      SKU: {{ item.variant.sku }}
                    </p>

                    <div
                      class="item-attributes"
                      *ngIf="item.variant?.attributes"
                    >
                      <span
                        class="attribute-tag"
                        *ngFor="let attr of item.variant.attributes | keyvalue"
                      >
                        {{ attr.key }}: {{ attr.value }}
                      </span>
                    </div>

                    <div class="item-pricing">
                      <div class="pricing-row">
                        <span class="pricing-label">Unit Price</span>
                        <ng-container
                          *ngIf="hasDiscount(item); else noDiscount"
                        >
                          <span class="pricing-value original-price">
                            MMK {{ item.price | number : "1.0-0" }}
                          </span>

                          <span class="pricing-value discounted-price">
                            MMK
                            {{ getDiscountedPrice(item) | number : "1.0-0" }}
                          </span>
                        </ng-container>
                        <ng-template #noDiscount>
                          <span class="pricing-value"
                            >MMK {{ item.price | number : "1.0-0" }}</span
                          >
                        </ng-template>
                      </div>
                      <div class="pricing-row total">
                        <span class="pricing-label">Subtotal</span>
                        <span class="pricing-value">MMK {{ getItemSubtotal(item) | number:'1.0-0' }}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Show More Items Card -->
                <div
                  class="more-items-card"
                  *ngIf="order?.orderDetails?.length > 1"
                >
                  <div class="more-items-content">
                    <div class="more-icon">
                      <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                      >
                        <circle cx="12" cy="12" r="1" />
                        <circle cx="19" cy="12" r="1" />
                        <circle cx="5" cy="12" r="1" />
                      </svg>
                    </div>
                    <div class="more-count">
                      +{{ order?.orderDetails.length - 1 }}
                    </div>
                    <div class="more-text">more items</div>
                    <button
                      class="view-all-items-btn"
                      (click)="showAllItemsModal = true"
                    >
                      View All Items
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Price Summary Card -->
          <div class="summary-card price-summary-card">
            <div class="card-header">
              <div class="card-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <line x1="12" y1="1" x2="12" y2="23" />
                  <path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" />
                </svg>
              </div>
              <h3 class="card-title">Order Summary</h3>
            </div>

            <div class="card-content">
              <div class="summary-breakdown">
                <div class="summary-row">
                  <span class="summary-label">Subtotal</span>
                  <span class="summary-value"
                    >MMK {{ order?.subtotal | number : "1.0-0" }}</span
                  >
                </div>

                <div class="summary-row">
                  <span class="summary-label">Delivery Fee</span>
                  <span class="summary-value"
                    >MMK {{ order?.deliveryFee | number : "1.0-0" }}</span
                  >
                </div>

                <div
                  class="summary-row discount"
                  *ngIf="order?.discountAmount > 0"
                >
                  <span class="summary-label">Discount</span>
                  <span class="summary-value">
                    <ng-container *ngIf="order?.discountType === 'Percentage'">
                      -{{ order?.discountValue }}% (MMK
                      {{ order?.discountAmount | number : "1.0-0" }})
                    </ng-container>
                    <ng-container
                      *ngIf="order?.discountType === 'Fixed Amount'"
                    >
                      -MMK {{ order?.discountAmount | number : "1.0-0" }}
                    </ng-container>
                  </span>
                </div>

                <div class="summary-divider"></div>

                <div class="summary-row total">
                  <span class="summary-label">Total Amount</span>
                  <span class="summary-value"
                    >MMK {{ order?.total | number : "1.0-0" }}</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- All Items Modal -->
  <div
    class="modal-overlay"
    *ngIf="showAllItemsModal"
    (click)="showAllItemsModal = false"
  >
    <div class="modal-container items-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">All Order Items</h3>
        <span class="modal-subtitle"
          >{{ order?.orderDetails?.length }} items in this order</span
        >
        <button class="modal-close" (click)="showAllItemsModal = false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="modal-items-list">
          <div
            class="modal-item-card"
            *ngFor="let item of order?.orderDetails; let i = index"
            [ngClass]="{ 'refunded-item': item.isRefunded }"
          >
            <div class="item-image-container">
              <img
                *ngIf="item.variant?.imageUrls?.length"
                [src]="item.variant.imageUrls[0]"
                [alt]="item.variant?.productName"
                class="item-image"
              />
              <div
                *ngIf="!item.variant?.imageUrls?.length"
                class="item-placeholder"
              >
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                  <circle cx="8.5" cy="8.5" r="1.5" />
                  <polyline points="21,15 16,10 5,21" />
                </svg>
              </div>
            </div>

            <div class="item-details">
              <h4 class="item-name">{{ item.variant?.productName }}</h4>
              <span *ngIf="item.isRefunded" class="refunded-badge"
                >Refunded{{
                  item.refundedQty ? " (" + item.refundedQty + ")" : ""
                }}</span
              >
              <p class="item-sku" *ngIf="item.variant?.sku">
                SKU: {{ item.variant.sku }}
              </p>

              <div class="item-attributes" *ngIf="item.variant?.attributes">
                <span
                  class="attribute-tag"
                  *ngFor="let attr of item.variant.attributes | keyvalue"
                >
                  {{ attr.key }}: {{ attr.value }}
                </span>
              </div>

              <div class="item-pricing">
                <div class="pricing-grid">
                  <div class="pricing-item">
                    <span class="pricing-label">Unit Price</span>
                    <ng-container
                      *ngIf="hasDiscount(item); else noDiscountModal"
                    >
                      <div class="discount-price-display">
                        <span class="pricing-value">
                          MMK {{ item.price | number : "1.0-0" }}
                        </span>
                      </div>
                    </ng-container>
                    <ng-template #noDiscountModal>
                      <span class="pricing-value"
                        >MMK {{ item.price | number : "1.0-0" }}</span
                      >
                    </ng-template>
                  </div>
                  <!-- New Discount Box -->
                  <div
                    class="pricing-item discount-box"
                    *ngIf="hasDiscount(item)"
                  >
                    <span class="pricing-label">Discount</span>
                    <span class="discount-value">
                      <ng-container [ngSwitch]="item.discountType">
                        <span *ngSwitchCase="'Fixed Amount'"
                          >MMK {{ item.discountAmount || 0 }}</span
                        >
                        <span *ngSwitchCase="'Percentage'"
                          >{{ item.discountPercent || 0 }}%</span
                        >
                        <span *ngSwitchCase="'Free Shipping'"
                          >Free Shipping</span
                        >
                        <span *ngSwitchDefault>0</span>
                      </ng-container>
                    </span>
                  </div>
                  <div class="pricing-item">
                    <span class="pricing-label">Quantity</span>
                    <span class="pricing-value">{{ item.quantity }}</span>
                  </div>
                  <div class="pricing-item total">
                    <span class="pricing-label">Subtotal</span>
                    <span class="pricing-value"
                      >MMK {{ getItemSubtotal(item) | number : "1.0-0" }}</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Summary -->
        <div class="modal-summary">
          <div class="modal-summary-row">
            <span class="summary-label">Total Items</span>
            <span class="summary-value">{{ getTotalItemsExcludingRefunds() }}</span>
          </div>
          <div class="modal-summary-row">
            <span class="summary-label">Total Quantity</span>
            <span class="summary-value">{{ getTotalQuantityExcludingRefunds() }}</span>
          </div>
          <div class="modal-summary-row total">
            <span class="summary-label">Items Subtotal</span>
            <span class="summary-value">MMK {{ getTotalSubtotalExcludingRefunds() | number:'1.0-0' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Hidden professional PDF receipt for export -->
  <div
    id="pdf-receipt"
    style="
      position: absolute;
      left: -9999px;
      top: 0;
      width: 850px;
      height: 800px;
      background: #ffffff;
      color: #000000;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      border: 1px solid #e2e8f0;
    "
  >
    <!-- Professional Header with Logo and Branding -->
    <div
      style="
        padding: 20px 30px 12px 30px;
        background: #000000;
        color: white;
        position: relative;
        flex-shrink: 0;
      "
    >
      <div
        style="
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 10px;
        "
      >
        <div style="display: flex; align-items: center; gap: 10px;">
          <div
            style="
              width: 36px;
              height: 36px;
              background: white;
              border-radius: 6px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <img
              src="assets/img/britiumGalleryBlack.png"
              alt="Britium Gallery"
              style="width: 28px; height: auto;"
            />
          </div>
          <div>
            <div
              style="
                font-size: 16px;
                font-weight: 700;
                margin-bottom: 1px;
              "
            >
              BRITIUM GALLERY
            </div>
            <div
              style="
                font-size: 10px;
                opacity: 0.8;
                font-weight: 500;
              "
            >
              Premium Fashion & Lifestyle
            </div>
          </div>
        </div>
        
        <div style="text-align: right;">
          <div
            style="
              font-size: 9px;
              opacity: 0.8;
              margin-bottom: 1px;
              font-weight: 600;
              text-transform: uppercase;
              letter-spacing: 0.5px;
            "
          >
            Order Receipt
          </div>
          <div
            style="
              font-size: 14px;
              font-weight: 700;
              margin-bottom: 2px;
            "
          >
            #{{ order?.trackingCode }}
          </div>
          <div
            style="
              font-size: 10px;
              opacity: 0.8;
            "
          >
            {{ order?.orderDate | date : "dd MMMM yyyy" }}
          </div>
        </div>
      </div>
      
      <!-- Order Status Badge -->
      <div
        style="
          display: inline-flex;
          align-items: center;
          gap: 4px;
          padding: 4px 8px;
          background: rgba(255, 255, 255, 0.15);
          border-radius: 12px;
          font-size: 8px;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        "
      >
        <div
          style="
            width: 4px;
            height: 4px;
            background: #10b981;
            border-radius: 50%;
          "
        ></div>
        {{ order?.status }}
      </div>
    </div>

    <!-- Main Content Area -->
    <div style="flex: 1; display: flex; flex-direction: column; min-height: 0; position: relative;">
      <!-- Customer & Order Information -->
      <div
        style="
          padding: 12px 30px 12px 30px;
          background: white;
          border-bottom: 1px solid #e2e8f0;
          flex-shrink: 0;
        "
      >
        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
          "
        >
          <!-- Customer Information -->
          <div>
            <div
              style="
                font-size: 10px;
                font-weight: 700;
                color: #4a5568;
                margin-bottom: 8px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
              "
            >
              Customer Information
            </div>
            <div
              style="
                font-size: 11px;
                font-weight: 600;
                margin-bottom: 3px;
              "
            >
              {{ order?.user?.name }}
            </div>
            <div
              style="
                font-size: 10px;
                color: #718096;
                margin-bottom: 1px;
              "
            >
              {{ order?.user?.email }}
            </div>
            <div
              style="
                font-size: 10px;
                color: #718096;
                margin-bottom: 1px;
              "
            >
              {{ order?.user?.phoneNumber }}
            </div>
          </div>
          
          <!-- Order Details -->
          <div>
            <div
              style="
                font-size: 10px;
                font-weight: 700;
                color: #4a5568;
                margin-bottom: 8px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
              "
            >
              Order Details
            </div>
            <div
              style="
                display: grid;
                grid-template-columns: auto 1fr;
                gap: 6px;
                font-size: 10px;
              "
            >
              <div style="color: #718096; font-weight: 500;">Payment:</div>
              <div style="font-weight: 600;">{{ transaction?.paymentMethod || 'N/A' }}</div>
              
              <div style="color: #718096; font-weight: 500;">Delivery:</div>
              <div style="font-weight: 600;">{{ order?.deliveryMethod }} - {{ order?.deliveryProvider }}</div>
              
              <div style="color: #718096; font-weight: 500;">Date:</div>
              <div style="font-weight: 600;">{{ order?.orderDate | date : "dd MMMM yyyy" }}</div>
              
              <div style="color: #718096; font-weight: 500;">Status:</div>
              <div style="font-weight: 600;">{{ order?.status }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Delivery Address -->
      <div
        style="
          padding: 10px 30px 10px 30px;
          background: #f7fafc;
          border-bottom: 1px solid #e2e8f0;
          flex-shrink: 0;
        "
      >
        <div
          style="
            font-size: 10px;
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
          "
        >
          Delivery Address
        </div>
        <div
          style="
            font-size: 10px;
            line-height: 1.3;
            color: #2d3748;
          "
        >
          {{ order?.deliveryAddress?.houseNumber }}, {{ order?.deliveryAddress?.street }}, {{ order?.deliveryAddress?.wardName }}, {{ order?.deliveryAddress?.township }}, {{ order?.deliveryAddress?.city }}, {{ order?.deliveryAddress?.state }}, {{ order?.deliveryAddress?.country }}
        </div>
      </div>

      <!-- Items Table -->
      <div style="padding: 12px 30px 0px 30px; flex: 1; min-height: 0;">
        <div
          style="
            font-size: 12px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
          "
        >
          Order Items
        </div>
        
        <table
          style="
            width: 100%;
            border-collapse: collapse;
            font-size: 10px;
          "
        >
          <thead>
            <tr
              style="
                background: #f7fafc;
                border-bottom: 1px solid #e2e8f0;
              "
            >
              <th
                style="
                  padding: 8px 0;
                  text-align: left;
                  font-weight: 700;
                  color: #4a5568;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                  font-size: 8px;
                  width: 40%;
                "
              >
                Item
              </th>
              <th
                style="
                  padding: 8px 0;
                  text-align: center;
                  font-weight: 700;
                  color: #4a5568;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                  font-size: 8px;
                  width: 15%;
                "
              >
                Qty
              </th>
              <th
                style="
                  padding: 8px 0;
                  text-align: right;
                  font-weight: 700;
                  color: #4a5568;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                  font-size: 8px;
                  width: 20%;
                "
              >
                Price
              </th>
              <th
                style="
                  padding: 8px 0;
                  text-align: right;
                  font-weight: 700;
                  color: #4a5568;
                  text-transform: uppercase;
                  letter-spacing: 0.5px;
                  font-size: 8px;
                  width: 25%;
                "
              >
                Total
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of order?.orderDetails; let i = index"
              style="border-bottom: 1px solid #f1f5f9;"
              [ngStyle]="{'display': item.isRefunded ? 'none' : 'table-row'}"
            >
              <td style="padding: 8px 0;">
                <div
                  style="
                    font-weight: 600;
                    color: #2d3748;
                    margin-bottom: 1px;
                    font-size: 9px;
                  "
                >
                  {{ item.variant?.productName }}
                </div>
                <div
                  *ngIf="item.variant?.attributes"
                  style="
                    font-size: 8px;
                    color: #718096;
                  "
                >
                  <span
                    *ngFor="
                      let attr of item.variant.attributes | keyvalue;
                      let last = last
                    "
                  >
                    {{ attr.key }}: {{ attr.value }}<span *ngIf="!last">, </span>
                  </span>
                </div>
                <div
                  *ngIf="item.variant?.sku"
                  style="
                    font-size: 8px;
                    color: #a0aec0;
                    margin-top: 1px;
                  "
                >
                  SKU: {{ item.variant.sku }}
                </div>
              </td>
              <td style="padding: 8px 0; text-align: center; font-weight: 600; font-size: 9px;">
                {{ item.quantity }}
              </td>
              <td style="padding: 8px 0; text-align: right;">
                <ng-container
                  *ngIf="
                    getDiscountedPrice(item) < item.price;
                    else noDiscountPrice
                  "
                >
                  <div
                    style="
                      text-decoration: line-through;
                      color: #a0aec0;
                      font-size: 8px;
                      margin-bottom: 1px;
                    "
                  >
                    MMK {{ item.price | number : "1.0-0" }}
                  </div>
                  <div
                    style="
                      font-weight: 600;
                      color: #2d3748;
                      font-size: 9px;
                    "
                  >
                    MMK {{ getDiscountedPrice(item) | number : "1.0-0" }}
                  </div>
                </ng-container>
                <ng-template #noDiscountPrice>
                  <div style="font-weight: 600; color: #2d3748; font-size: 9px;">
                    MMK {{ item.price | number : "1.0-0" }}
                  </div>
                </ng-template>
              </td>
              <td style="padding: 8px 0; text-align: right; font-weight: 700; font-size: 9px;">
                MMK {{ getItemSubtotal(item) | number : "1.0-0" }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Order Summary -->
      <div
        style="
          padding: 12px 30px 12px 30px;
          background: #f7fafc;
          border-top: 1px solid #e2e8f0;
          flex-shrink: 0;
          margin-top: 0;
        "
      >
        <div
          style="
            display: flex;
            justify-content: flex-end;
          "
        >
          <div
            style="
              width: 280px;
              padding-right: 0px;
            "
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-bottom: 5px;
                font-size: 10px;
              "
            >
              <span style="color: #4a5568;">Subtotal</span>
              <span style="font-weight: 600;">MMK {{ getTotalSubtotalExcludingRefunds() | number : "1.0-0" }}</span>
            </div>
            
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-bottom: 5px;
                font-size: 10px;
              "
            >
              <span style="color: #4a5568;">Delivery Fee</span>
              <span style="font-weight: 600;">MMK {{ order?.deliveryFee | number : "1.0-0" }}</span>
            </div>
            
            <div
              *ngIf="order?.couponCode"
              style="
                display: flex;
                justify-content: space-between;
                margin-bottom: 5px;
                font-size: 10px;
              "
            >
              <span style="color: #4a5568;">Coupon ({{ order?.couponCode }})</span>
              <span style="font-weight: 600; color: #e53e3e;">
                -MMK {{ order?.discountAmount | number : "1.0-0" }}
              </span>
            </div>
            
            <div
              *ngIf="order?.discountAmount > 0 && !order?.couponCode"
              style="
                display: flex;
                justify-content: space-between;
                margin-bottom: 5px;
                font-size: 10px;
              "
            >
              <span style="color: #4a5568;">Discount</span>
              <span style="font-weight: 600; color: #e53e3e;">
                -MMK {{ order?.discountAmount | number : "1.0-0" }}
              </span>
            </div>
            
            <div
              style="
                height: 1px;
                background: #e2e8f0;
                margin: 8px 0;
              "
            ></div>
            
            <div
              style="
                display: flex;
                justify-content: space-between;
                font-size: 14px;
                font-weight: 700;
                color: #2d3748;
              "
            >
              <span>Total Amount</span>
              <span>MMK {{ getTotalAmountExcludingRefunds() | number : "1.0-0" }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div
      style="
        padding: 12px 30px;
        background: #000000;
        color: white;
        text-align: center;
        flex-shrink: 0;
      "
    >
      <div
        style="
          font-size: 12px;
          font-weight: 700;
          margin-bottom: 4px;
        "
      >
        Thank You for Your Order!
      </div>
      <div
        style="
          font-size: 9px;
          opacity: 0.8;
          margin-bottom: 8px;
        "
      >
        We appreciate your business and hope you enjoy your purchase.
      </div>
      <div
        style="
          font-size: 8px;
          opacity: 0.6;
          font-weight: 500;
        "
      >
        www.britiumgallery.com
      </div>
    </div>
  </div>
</div>
